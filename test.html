<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <script src="https://cdn.jsdelivr.net/npm/@multisynq/client@latest/bundled/multisynq-client.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        #counter { font-size: 24px; margin: 20px 0; }
        button { padding: 10px 20px; margin: 5px; font-size: 16px; }
    </style>
</head>
<body>
    <h1>Multisynq Test</h1>
    <div id="counter">Count: 0</div>
    <button id="increment">+1</button>
    <button id="reset">Reset</button>
    
    <script>
        class CounterModel extends Multisynq.Model {
            init() {
                this.count = 0;
                this.subscribe(this.sessionId, "increment", this.handleIncrement);
                this.subscribe(this.sessionId, "reset", this.handleReset);
            }
            
            handleIncrement() {
                this.count += 1;
                this.publish(this.sessionId, "countChanged", this.count);
            }
            
            handleReset() {
                this.count = 0;
                this.publish(this.sessionId, "countChanged", this.count);
            }
        }
        
        class CounterView extends Multisynq.View {
            constructor(model) {
                super(model);
                this.subscribe(this.sessionId, "countChanged", this.updateDisplay);
                this.setupUI();
                this.updateDisplay(model.count);
            }
            
            setupUI() {
                document.getElementById("increment").addEventListener("click", () => {
                    this.publish(this.sessionId, "increment");
                });
                
                document.getElementById("reset").addEventListener("click", () => {
                    this.publish(this.sessionId, "reset");
                });
            }
            
            updateDisplay(count) {
                document.getElementById("counter").textContent = `Count: ${count}`;
            }
        }
        
        // Start Multisynq session
        Multisynq.Session.join({
            apiKey: "2GzxJfKu10qeIJcl0FsTY5AbhgXQj2ZgaXJhm6jHbK",
            appId: "com.example.counter",
            model: CounterModel,
            view: CounterView,
            name: Multisynq.App.autoSession(),
            password: Multisynq.App.autoPassword()
        }).then(session => {
            console.log("Joined session:", session.id);
            Multisynq.App.makeWidgetDock();
        }).catch(error => {
            console.error("Failed to join session:", error);
        });
    </script>
</body>
</html> 